<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Quiz Game - 3 Rounds</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f3;
      text-align: center;
      padding: 50px;
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: auto;
    }
    input[type="number"] {
      padding: 10px;
      width: 100px;
      font-size: 1.2em;
    }
    button {
      padding: 10px 25px;
      font-size: 1em;
      margin-top: 15px;
    }
    .correct { color: green; }
    .incorrect { color: red; }
    .hidden { display: none; }
    #timer { font-weight: bold; color: #444; margin: 10px 0; }
    #summary { text-align: left; margin-top: 20px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Math Quiz Game üß†</h2>
    <p id="roundInfo">Round 1: Addition</p>
    <p id="progress">Problem 1 of 20</p>
    <div id="timer">Time: 0s</div>
    <h3 id="question">Loading...</h3>
    <input type="number" id="answer" placeholder="Your answer">
    <br>
    <button onclick="submitAnswer()">Submit</button>
    <p id="feedback" class="hidden"></p>
    <div id="endMessage" class="hidden"></div>
    <div id="summary" class="hidden"></div>
  </div>

  <script>
    let round = 1; // 1: Addition, 2: Subtraction, 3: Multiplication
    let questionNumber = 0;
    let currentAnswer = 0;
    let startTime = 0;
    let timerInterval;

    // Tracking per round
    const roundTimes = [[], [], []];
    const incorrectCounts = [0, 0, 0];

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function updateRoundInfo() {
      const roundNames = ["Addition", "Subtraction", "Multiplication"];
      document.getElementById("roundInfo").textContent = `Round ${round}: ${roundNames[round - 1]}`;
      document.getElementById("progress").textContent = `Problem ${questionNumber + 1} of 20`;
    }

    function generateProblem() {
      let a, b, question;

      if (round === 1) {
        a = getRandomInt(10, 99);
        b = getRandomInt(10, 99);
        question = `${a} + ${b}`;
        currentAnswer = a + b;
      } else if (round === 2) {
        a = getRandomInt(10, 99);
        b = getRandomInt(10, 99);
        if (b > a) [a, b] = [b, a];
        question = `${a} - ${b}`;
        currentAnswer = a - b;
      } else {
        a = getRandomInt(3, 9);
        b = getRandomInt(3, 9);
        question = `${a} √ó ${b}`;
        currentAnswer = a * b;
      }

      document.getElementById("question").textContent = question;
      document.getElementById("feedback").classList.add("hidden");
      document.getElementById("answer").value = "";
      updateRoundInfo();

      startTimer();
    }

    function startTimer() {
      startTime = Date.now();
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById("timer").textContent = `Time: ${elapsed}s`;
      }, 500);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      const elapsed = (Date.now() - startTime) / 1000;
      roundTimes[round - 1].push(elapsed);
    }

    function submitAnswer() {
      const userInput = parseInt(document.getElementById("answer").value);
      const feedback = document.getElementById("feedback");

      if (isNaN(userInput)) {
        feedback.textContent = "‚ö†Ô∏è Please enter a number.";
        feedback.className = "incorrect";
        feedback.classList.remove("hidden");
        return;
      }

      if (userInput === currentAnswer) {
        stopTimer();
        questionNumber++;
        feedback.textContent = "‚úÖ Correct!";
        feedback.className = "correct";
        feedback.classList.remove("hidden");

        if (questionNumber === 20) {
          if (round < 3) {
            round++;
            questionNumber = 0;
            setTimeout(generateProblem, 800);
          } else {
            endQuiz();
            return;
          }
        }

        setTimeout(generateProblem, 600);
      } else {
        incorrectCounts[round - 1]++;
        feedback.textContent = "‚ùå Incorrect. Try again!";
        feedback.className = "incorrect";
        feedback.classList.remove("hidden");
      }
    }

    function average(arr) {
      if (arr.length === 0) return 0;
      const total = arr.reduce((a, b) => a + b, 0);
      return (total / arr.length).toFixed(2);
    }

    function endQuiz() {
      document.getElementById("endMessage").innerHTML = `<h3>üéâ You've completed all 3 rounds!</h3>`;
      document.getElementById("endMessage").classList.remove("hidden");
      document.getElementById("question").classList.add("hidden");
      document.getElementById("answer").classList.add("hidden");
      document.querySelector("button").classList.add("hidden");
      document.getElementById("progress").classList.add("hidden");
      document.getElementById("roundInfo").classList.add("hidden");
      document.getElementById("timer").classList.add("hidden");

      const roundNames = ["Addition", "Subtraction", "Multiplication"];
      let summaryHTML = `<h4>üìä Your Performance Summary:</h4><ul>`;
      for (let i = 0; i < 3; i++) {
        summaryHTML += `
          <li>
            <strong>${roundNames[i]}:</strong><br>
            ‚è±Ô∏è Avg Time: ${average(roundTimes[i])} seconds<br>
            ‚ùå Incorrect Attempts: ${incorrectCounts[i]}
          </li><br>`;
      }
      summaryHTML += `</ul>`;
      document.getElementById("summary").innerHTML = summaryHTML;
      document.getElementById("summary").classList.remove("hidden");
    }

    // Start game
    generateProblem();
  </script>

</body>
</html>
